# Date: "네가 뭘 좋아할지 몰라서 다 준비했어"

## GMT 와 UTC 가 뭘까?

### GMT

GMT는 태양을 기준으로 한 그리니치 평균시로, 영국 그리니치 천문대를 지나는 본초자오선(경도 0도)을 기준으로 한다. 지구를 약 15도씩 나눠서 24개의 시간대를 만든 것이다.

TMI 로 '본초자오선'이라는 용어가 입에 잘 붙지 않아 찾아보니 다음과 같은 의미를 담고 있다.

- 자(子, 북쪽)오(午, 남쪽)선: 북과 남을 잇는 선
- 본(本, 근본) 초(初, 처음): 근본의 처음
- 본초자오선(本初子午線): 북과 남을 잇는 선 중 처음이 되는 기준선

즉, 본초자오선(本初子午線)은 북쪽과 남쪽을 잇는 선 중에서 가장 처음이 되는 기준선이라는 뜻이다.

1967년 '초' 라는 시간 단위 정의가 바뀌었는데 기존에는 지구가 한 바퀴 자전하는 것을 24시간으로 삼았지만 태양이 뜨고 지는 시간, 즉 지구가 한 바퀴 자전하는 시간을 `하루를 24시간 * 1시간 60분 * 1분 60초 = 86,400` 으로 나눈 단위였다.

하지만 과학자들은 지구의 자전의 속도가 미세하게 느려지고 있다는 것을 알게됐고 우주 어디에서도 절대 변하지 않는 시간 단위, 원자 시계 기반 시계 기준(UTC)을 만들었다.

### UTC

UTC는 원자 시계를 기준으로 한 전 세계 시간의 기준이다. 세슘 원자의 진동수를 기준이 원자 시계다.(TMI: 세슘 원자로 정한 이유는 세슘 원자는 온도, 압력 같은 외부 조건에 영향을 받지 않고 원자의 진동 주기가 매우 안정적으로 일정하기 때문이라고 한다.)

지구의 자전 속도에 따라 미세하게 느려진 GMT 와 다르게 UTC 는 지구의 자전 속도와 원자 시계의 간격을 위해 필요할 때, 6월 30일 혹은 12월 31일에 1초를 추가하거나 삭제하면서 '초'의 정의를 바꾸지 않고 시간을 보정할 수 있다.

UTC+0:00이 영국 시간이다. 이 시간대를 기준으로 각 지역의 시차를 정하는데, 예를 들어 한국은 영국보다 9시간 빠른 UTC+09:00이다. (빠르다는 것은 영국보다 한국이 9시간 앞서 있다, 지났다는 것을 의미)

### ISO 8601

ISO 8601은 국제 표준으로 정의된 날짜 및 시간 표기 형식이다. 이 형식은 다음과 같다:

```md
날짜: yyyy-mm-dd
시간: hh:mm:ss (날짜와 시간 사이에 T를 사용)
예: 2023-12-01T09:00:00Z (Z는 UTC 시간을 나타냄 / Z가 없으면 현지 시각을 나타냄)
UTC 시간대가 아닐 경우, +hh:mm 혹은 -hh:mm 등의 형식을 사용
```

그렇다면 자바스크립트의 Date는 무엇을 기준으로 삼는 걸까? 우리의 컴퓨터는 기본적으로 UTC 기반으로 동작하고, 자바스크립트도 UTC로 시간을 처리한다.

하지만 아래 코드를 실행해보면 GMT로 표기된 결과를 받을 수 있다.

```js
new Date();
// Fri Dec 01 2023 16:55:01 GMT+0900
```

[21.4 Date Objects](https://tc39.es/ecma262/multipage/numbers-and-dates.html#sec-date-objects)에 따르면, 자바스크립트는 UTC를 기준으로 시간 값을 정의하지만, 일관성을 제공하기 위해 윤초를 고려하지 않고 하루를 86,400초로 계산한다고 한다. 이 때문에 GMT와 UTC 개념이 섞여 혼란을 주는 것 같다.

왜 이렇게 혼란을 주게 되었을까 찾아보니, 자바스크립트가 처음 개발될 당시에는 많은 시스템이 GMT를 사용하고 있었다고 한다. 그래서 호환성을 유지하기 위해 GMT 용어를 사용했다고 한다. (그래도 UTC는 1972년 1월 1일부터 시행됐고, 자바스크립트는 1995년 12월 4일에 발표됐는데 그 사이에 UTC로 통일할 순 없었을까?)

결론적으로, 자바스크립트에서는 UTC 로 계산하지만 주로 출력 형식에서 GMT로 표기하고, GMT와 UTC 개념이 합쳐져 있다고 보면 된다. (눈물난다. 뇌를 빼고 받아들여야겠다.) 굳이 정의하자면, 자바스크립트는 UTC 기준으로 계산된다는 것만 기억하려고 한다.

```jsx
Date.now();
// 1701419567172
```

위 코드를 실행하면 1970년 1월 1일 0시 0분 0초를 기준으로 흐른 시간을 밀리초 단위로 보여준다.

그렇다면 왜 하필 1970년 1월 1일 0시 0분 0초가 기준일까?

이 날짜는 컴퓨터가 현재 시각을 기억하기 위해 설정한 기준 시점으로, 유닉스 타임(Unix Time)이라고 불린다. 유닉스 타임은 운영 체제와 상관없이 일관된 시간 기준을 제공하기 위해 만들어졌다. 시간대와 관계없이 전 세계 어디에서 호출해도 동일한 시점에 호출된다면 동일한 값을 반환하는 것이다. 이를 통해 시스템 간의 시간 동기화가 가능해진다.

## Date 사용법

혼란스러운 개념만큼이나 자바스크립트 `Date` 사용법도 아주 다양하다.

```js
// 1. 인자가 없을 경우
new Date(); // GMT 기준으로 컴퓨터에서 사용하는 타임 존 반환
// Fri Dec 01 2023 16:55:01 GMT+0900

// 2. + 붙일 경우
+new Date(); // 현재 시간의 유닉스 타임스탬프를 밀리초 단위로 반환
// 1701419510674

// 3. 밀리세컨드를 줄 경우
new Date(milliseconds); // UTC+0 기준으로 1970년 1월 1일 0시 0분 0초 밀리초 후의 Date 객체 (단, 결과는 시스템 로컬 시간대에 맞춰서 표시됨)
// new Date(60 * 1000) Thu Jan 01 1970 09:01:00 GMT+0900 (한국 표준시)

// 4. 문자열 시간 경우
new Date("날짜"); // 컴퓨터 타임존으로 인식 후 반환 - parsed(Data.parse 와 동일한 알고리즘 방법)
// new Date('2023-12-01') Fri Dec 01 2023 09:00:00 GMT+0900 (한국 표준시)
// new Date('2023-12-01T09:00:00') 현지 시간 09시간이 되어버린다.
// 따라서 반드시 +09:00 를 붙여줘야 안전하다.

// 5. 년, 월, 일, 시간, 분 개별 값 경우
new Date(year필수, month필수, date, hours, minutes, seconds, ms);
// new Date(2023,11) Fri Dec 01 2023 00:00:00 GMT+0900 (한국 표준시)

// 6. ISO 8601 형식
new Date("2023-12-01T09:00:00+09:00");
// Fri Dec 01 2023 09:00:00 GMT+0900 (한국 표준시) 한국 컴퓨터
// Fri Dec 01 2023 11:00:00 GMT+1100 (호주 동부 하계 표준시) 호주 동부 컴퓨터
```

자바스크립트에서 현재 시간을 밀리초 단위로 얻고자 할 때는 `Date.now()`를 사용하면 된다.

```js
Date.now();
// 1701419567172 (=Fri Dec 01 2023 17:32:47 GMT+0900 (한국 표준시))
// new Date().getTime() 과 의미는 동일
// Date 객체를 만들지 않는다.
// 빠르고 가비지 컬렉터의 일을 덜어준다.
```

날짜 문자열을 파싱하려면 `Date.parse()`를 사용하면 된다.

```js
Date.parse(string);
// YYYY-MM-DD-THH:mm:ss:sss 처럼 된 형식만 받아줌 RFC2822 또는 ISO 8601 날짜를 나타내는 문자열
// 문자열과 대응하는 날짜, 타임 스탬프를 반환함
// 형식에 안맞으면 NaN 반환

Date.parse("Fri Dec 01 2023 17:32:47"); // 1701419567000
Date.parse("2023-12-01T17:32:47"); // 1701419567000
```

예를 들어 `new Date('2023-12-01T09:00:00')`를 호주에서 쓰면 호주 현지 시간 아침 9시를 반환한다. 마찬가지로 미국에서 써도 미국 현지 시간 아침 9시를 반환한다. 따라서 이렇게 쓰면 코드가 현지 기준에 따라 동작해서 원하는 정확한 기준을 세울 수 없다.

```js
new Date("2023-12-01T09:00:00");

// 한국에서 실행했을 때
// Fri Dec 01 2023 09:00:00 GMT+0900 (한국 표준시) -> 한국 9시

// 호주에서 실행했을 때
// Fri Dec 01 2023 09:00:00 GMT+1100 (호주 표준시) -> 호주 9시
```

반면에 `new Date('2023-12-01T09:00:00+09:00')`를 호주에서 쓰면 호주 시간 11시로 변환된다.

```js
new Date("2023-12-01T09:00:00+09:00");

// 한국에서 실행했을 때
// Fri Dec 01 2023 09:00:00 GMT+0900 (한국 표준시) -> 한국 9시

// 호주에서 실행했을 때
// Fri Dec 01 2023 11:00:00 GMT+1100 (호주 표준시) -> 한국 9시일 때의 호주 시간
```

## 마치면서

이 포스팅은 클라우드에 배너를 업로드하는 유틸리티를 작업하면서, 같은 팀원들에게 설명할 자료용으로 준비했다. 하지만 솔직히 말해, 아무리 생각하고 정리해도 매번 헷갈린다. 며칠 뒤에 다시 설명하려고 하면 더더욱 자신이 없다. 발표는 겨우 했지만, "그래서 왜 시간이 다르다고요?"라는 질문에 명확하게 답변하지 못했다.

이 코드를 유틸로 사용하긴 편하겠지만 유틸 구현 부분을 나중에 내가 다시 수정하거나 다른 사람이 유지보수해야 한다면, 그 사람도 나처럼 `Date` 객체를 공부해야 할 것이다. 자바스크립트의 `Date` 객체는 문법이 어렵다기보다, 할 수 있는 것이 너무 다양하고 복잡하며 일관성이 부족하다. 마치 "뭘 좋아할지 몰라서 다 준비했어" 같다. 이런 복잡함 때문에 직접 구현하는 것보다, 검증된 라이브러리를 사용하는 것이 더 편리하고 유지보수에도 훨씬 좋을 것 같다.

결론적으로, 시간을 다루는 작업에서는 라이브러리를 사용하는 것이 속편하고, 코드의 가독성과 유지보수성도 더 좋다고 생각한다.

## 참고자료

- [나무위키 - 시간 체계](https://namu.wiki/w/%EC%8B%9C%EA%B0%84%20%EC%B2%B4%EA%B3%84#%EA%B7%B8%EB%A6%AC%EB%8B%88%EC%B9%98%20%ED%8F%89%EA%B7%A0%EC%8B%9C)
- [왜 내가 작성한 JavaScript Date 코드가 서버에서는 다르게 보이는 거죠? | 요즘IT](https://yozm.wishket.com/magazine/detail/1695/)
- [21.4 Date Objects](https://tc39.es/ecma262/multipage/numbers-and-dates.html#sec-date-objects)
- [MDN - Date 생성자]https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Date/Date
- [본초자오선? 지오이드? 그게 뭔데요? | 생각의 감칠맛, 다시답 ep.03](https://www.youtube.com/watch?v=tlAdhA8ejl4)
